if(window.myNav=navigator.userAgent.toLowerCase(),window.myNav=-1!=window.myNav.indexOf("msie")&&parseInt(window.myNav.split("msie")[1]),window.myNav&&window.myNav<=8){var scr=document.getElementsByTagName("script"),lastSrcipt=scr[scr.length-1];lastSrcipt.insertAdjacentHTML("afterend",'<div id="old">Votre navigateur ne peut pas afficher les widgets ISTEX, veuillez en utiliser un plus récent : Internet Explorer 9 ou plus, Google Chrome, Firefox,...</div>')}for(var scripts=document.getElementsByTagName("script"),isSlider=!1,i=0;i<scripts.length;i++)/\/rzslider.js/.test(scripts[i].src)&&(isSlider=!0);if(!1!==window.istexConfig.slider&&isSlider)var app=angular.module("app",["rzModule","ngSanitize","ui.select"]);else app=angular.module("app",["ngSanitize","ui.select"]);app.config(["$compileProvider",function(e){e.debugInfoEnabled(!1)}]);var extend=function(e){var t={},a=function(e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])};a(arguments[0]);for(var i=1;i<arguments.length;i++){a(arguments[i])}return t};app.filter("proxify",function(){return function(e,t){return null!=e&&"https://api.panist.fr"!==t&&(e=e.replace("https://api.panist.fr",t)),e}}),app.filter("capitalize",function(){return function(e,t){return null!=e&&(e=e.toLowerCase()),e.substring(0,1).toUpperCase()+e.substring(1)}}),app.filter("numberize",function(){return function(e,t){return null!=e&&(e=e.toString().replace(/(\d)(?=(\d{3})+$)/g,"$1 ")),e}}),app.filter("ellipse",function(){return function(e,t,a,i){if(!e)return"";if(!(a=parseInt(a,10)))return e;if(e.length<=a)return e;if(e=e.substr(0,a),t){var s=e.lastIndexOf(" ");-1!=s&&(e=e.substr(0,s))}return e+(i||" …")}}),app.filter("languagize",function(){return function(e,t){if(!e)return"";if("en"===t)switch(e){case"fre":return"French";case"eng":return"English";case"lat":return"Latin";case"deu":case"ger":return"German";case"spa":return"Spanish";case"dut":return"Dutch";case"ita":return"Italian";case"por":return"Portuguese";case"rus":return"Russian";case"wel":return"Welsh";case"glg":return"Galician";case"grc":case"gre":return"Greek";case"ara":return"Arabian";case"heb":return"Hebrew";case"pol":return"Polish";case"dan":return"Danish";case"swe":return"Swedish";case"moh":return"Mohawk";case"syr":return"Syriac";case"per":return"Persian";case"frm":return"French, Middle";case"mul":return"Multiple languages";case"unknown":return"Unknown";default:return e}else switch(e){case"fre":return"Français";case"eng":return"Anglais";case"lat":return"Latin";case"deu":case"ger":return"Allemand";case"spa":return"Espagnol";case"dut":return"Néerlandais";case"ita":return"Italien";case"por":return"Portugais";case"rus":return"Russe";case"wel":return"Gallois";case"glg":return"Galicien";case"grc":case"gre":return"Grec";case"ara":return"Arabe";case"heb":return"Hébreu";case"pol":return"Polonais";case"dan":return"Danois";case"swe":return"Suédois";case"moh":return"Mohawk";case"syr":return"Syriaque";case"per":return"Persan";case"frm":return"Français moyen";case"mul":return"Multilingue";case"unknown":return"Non spécifié";default:return e}}}),app.filter("sidize",function(){return function(e,t){return-1!==e.indexOf("sid=")?e:e+=-1!==e.indexOf("?")?"&sid=istex-widgets":"?sid=istex-widgets"}}),app.directive("ngToggle",function(){return{link:function(e,t,a){t=t[0];var i=a.ngToggle;e.$watch(i,function(e,a){t.style.opacity=e?"1":"0"})},restrict:"A"}}),app.directive("ngFocus",function(){return{link:function(e,t,a){t=t[0];var i=a.ngFocus;e.$eval(i)&&t.focus(),e.$watch(i,function(e,a){e!==a&&(e?t.focus():t.blur())})},restrict:"A"}}),app.directive("istexFacets",function(){return{template:'<div id="istex-widget-facets" style="opacity: 1;" ng-controller="IstexfacetsCtrl" ng-toggle="showFacets && aggregations"><div class="istex-facets"><h3 class="istex-facets-title">{{ istexConfigDefault.labels.facets["title"] || "Affiner votre recherche" }}</h3><form class="istex-facets" ><div class="istex-facet" ng-repeat="(facetName, facet) in aggregations"><h4 class="istex-facet-name" ng-click="shownFacet = !shownFacet;">{{ (istexConfigDefault.labels.facets[facetName] || facetName) | capitalize }}<div ng-class="shownFacet ? \'icon arrow\' : \'icon arrow flipped\'" ng-style="shownFacet && { width: \'silver\', display: \'inline-block\'} || { color: \'gold\', display: \'inline-block\' }"></div></h4><div class="animate-switch-container" ng-switch on="facetName"><div class="istex-facet-checkbox corpus" ng-switch-when="corpusName" ng-if="shownFacet"><li ng-repeat="badge in facet.buckets"><label><input type="checkbox" ng-model="badge.isChecked" ng-click="submitFacetSearch(aggregations)">{{ badge.key | capitalize}}<span class="istex-facet-checkbox-badge" >{{ badge.docCount | numberize }}</span></label></li></div><div class="istex-facet-checkbox language" ng-switch-when="language" ng-if="shownFacet"><li ng-repeat="badge in facet.buckets"><label><input type="checkbox" ng-model="badge.isChecked" ng-click="submitFacetSearch(aggregations)">{{ badge.key | languagize:istexConfigDefault.labels.facets["traduction"] }}<span class="istex-facet-checkbox-badge" >{{ badge.docCount | numberize }}</span></label></li></div><div class="istex-facet-checkbox wos" ng-switch-when="categories.wos" ng-if="shownFacet"><li ng-repeat="badge in facet.buckets" title="{{badge.key | capitalize}}"><label><input type="checkbox" ng-model="badge.isChecked" ng-click="submitFacetSearch(aggregations)" >{{ badge.key  | capitalize | ellipse:false:27:"..."   }}<span class="istex-facet-checkbox-badge" >{{ badge.docCount | numberize }}</span></label></li></div><div class="istex-facet-checkbox wos" ng-switch-when="wos" ng-if="shownFacet">Un bug est survenu :/</div><div class="istex-facet-checkbox inist" ng-switch-when="categories.inist" ng-if="shownFacet"><li ng-repeat="badge in facet.buckets" title="{{badge.key | capitalize}}"><label><input type="checkbox" ng-model="badge.isChecked" ng-click="submitFacetSearch(aggregations)" >{{ badge.key  | capitalize | ellipse:false:27:"..."   }}<span class="istex-facet-checkbox-badge" >{{ badge.docCount | numberize }}</span></label></li></div><div class="istex-facet-checkbox inist" ng-switch-when="inist" ng-if="shownFacet">Un bug est survenu :/</div><div class="istex-facet-checkbox scopus" ng-switch-when="categories.scopus" ng-if="shownFacet"><li ng-repeat="badge in facet.buckets" title="{{badge.key | capitalize}}"><label><input type="checkbox" ng-model="badge.isChecked" ng-click="submitFacetSearch(aggregations)" >{{ badge.key  | capitalize | ellipse:false:27:"..."   }}<span class="istex-facet-checkbox-badge" >{{ badge.docCount | numberize }}</span></label></li></div><div class="istex-facet-checkbox scopus" ng-switch-when="scopus" ng-if="shownFacet">Un bug est survenu :/</div><div class="istex-facet-checkbox scienceMetrix" ng-switch-when="categories.scienceMetrix" ng-if="shownFacet"><li ng-repeat="badge in facet.buckets" title="{{badge.key | capitalize}}"><label><input type="checkbox" ng-model="badge.isChecked" ng-click="submitFacetSearch(aggregations)" >{{ badge.key  | capitalize | ellipse:false:27:"..."   }}<span class="istex-facet-checkbox-badge" >{{ badge.docCount | numberize }}</span></label></li></div><div class="istex-facet-checkbox scienceMetrix" ng-switch-when="scienceMetrix" ng-if="shownFacet">Un bug est survenu :/</div><div class="istex-facet-checkbox teeft" ng-switch-when="keywords.teeft" ng-if="shownFacet"><li ng-repeat="badge in facet.buckets" title="{{badge.key | capitalize}}"><label><input type="checkbox" ng-model="badge.isChecked" ng-click="submitFacetSearch(aggregations)" >{{ badge.key  | capitalize | ellipse:false:27:"..."   }}<span class="istex-facet-checkbox-badge" >{{ badge.docCount | numberize }}</span></label></li></div><div class="istex-facet-checkbox teeft" ng-switch-when="teeft" ng-if="shownFacet">Un bug est survenu :/</div><div class="istex-facet-copyrightdate" ng-switch-when="copyrightDate" ng-if="shownFacet"><div ng-if="!istexConfigDefault.slider">Entre <input type="number" min="{{ facet.buckets[0].fromAsString }}" max="{{ facet.buckets[0].toAsString }}" ng-model="facet.buckets[0].bot" ng-change="submitFacetSearch(aggregations)" > et <input type="number" min="{{ facet.buckets[0].fromAsString }}" max="{{ facet.buckets[0].toAsString }}" ng-model="facet.buckets[0].top" ng-change="submitFacetSearch(aggregations)" ></div><div ng-if="istexConfigDefault.slider"><rzslider class="rzslider" rz-slider-floor="facet.buckets[0].fromAsString" rz-slider-ceil="facet.buckets[0].toAsString" rz-slider-model="facet.buckets[0].bot" rz-slider-high="facet.buckets[0].top" rz-slider-step="1" ></rzslider></div></div><div class="istex-facet-pubdate" ng-switch-when="publicationDate" ng-if="shownFacet"><div ng-if="!istexConfigDefault.slider">Entre <input type="number" min="{{ facet.buckets[0].fromAsString }}" max="{{ facet.buckets[0].toAsString }}" ng-model="facet.buckets[0].bot" ng-change="submitFacetSearch(aggregations)" > et <input type="number" min="{{ facet.buckets[0].fromAsString }}" max="{{ facet.buckets[0].toAsString }}" ng-model="facet.buckets[0].top" ng-change="submitFacetSearch(aggregations)" ></div><div ng-if="istexConfigDefault.slider"><rzslider class="rzslider" rz-slider-floor="facet.buckets[0].fromAsString" rz-slider-ceil="facet.buckets[0].toAsString" rz-slider-model="facet.buckets[0].bot" rz-slider-high="facet.buckets[0].top" rz-slider-step="1" ></rzslider></div></div><div class="istex-facet-quality" ng-switch-when="score" ng-if="shownFacet"><div ng-if="!istexConfigDefault.slider">Entre <input type="number" min="0" max="10" ng-model="facet.buckets[0].bot" ng-change="submitFacetSearch(aggregations)" > et <input type="number" min="0" max="10" ng-model="facet.buckets[0].top" ng-change="submitFacetSearch(aggregations)" ></div><div ng-if="istexConfigDefault.slider"><rzslider class="rzslider" rz-slider-floor="0" rz-slider-ceil="10" rz-slider-model="facet.buckets[0].bot" rz-slider-high="facet.buckets[0].top" rz-slider-step="1" ></rzslider></div></div><div class="istex-facet-checkbox {{ facetName }}" ng-switch-default><li ng-repeat="badge in facet.buckets" title="{{badge.key | capitalize}}"><label><input type="checkbox" ng-model="badge.isChecked" ng-click="submitFacetSearch(aggregations)" >{{ badge.key  | capitalize | ellipse:false:27:"..."   }}<span class="istex-facet-checkbox-badge" >{{ badge.docCount | numberize }}</span></label></li></div></div></div></form></div></div>'}}),app.controller("IstexfacetsCtrl",["$scope","$rootScope","$timeout","istexFacetsService",function(e,t,a,s){t.showFacets=!1,t.shownFacet=t.istexConfigDefault.shownFacet,t.queriedFacets={},t.istexConfigDefault.slider&&e.$on("slideEnded",function(){e.submitFacetSearch(e.aggregations)}),e.submitFacetSearch=function(a){t.showResults=!1,t.showLoading=!0,s.facetSearch(e,a).success(function(e){if(console.log("resulst : "+e),t.showError=!1,t.searchTimeB=(new Date).getTime(),t.totalSearchTime=((t.searchTimeB-t.searchTimeA)/1e3).toFixed(2),t.noresult=0===e.total,!t.noresult){t.elasticSearchTime=(e.stats.elasticsearch.took/1e3).toFixed(2),t.istexSearchTime=(e.stats["istex-api"].took/1e3).toFixed(2),t.reseauSearchTime=(t.totalSearchTime-t.elasticSearchTime-t.istexSearchTime).toFixed(2),t.documents=e.hits,t.total=e.total,t.nextPageURI=e.nextPageURI,e.aggregations&&e.aggregations.publicationDate&&!t.queriedFacets.publicationDate&&(e.aggregations.publicationDate.buckets[0].top=parseInt(e.aggregations.publicationDate.buckets[0].toAsString),e.aggregations.publicationDate.buckets[0].bot=parseInt(e.aggregations.publicationDate.buckets[0].fromAsString||0)),e.aggregations&&e.aggregations.copyrightDate&&!t.queriedFacets.copyrightDate&&(e.aggregations.copyrightDate.buckets[0].top=parseInt(e.aggregations.copyrightDate.buckets[0].toAsString),e.aggregations.copyrightDate.buckets[0].bot=parseInt(e.aggregations.copyrightDate.buckets[0].fromAsString||0)),e.aggregations&&e.aggregations.score&&!t.queriedFacets.score&&(e.aggregations.score.buckets[0].top=10,e.aggregations.score.buckets[0].bot=0);for(var a in t.queriedFacets)t.queriedFacets.hasOwnProperty(a)&&("wos"==a?e.aggregations["categories.wos"]=t.queriedFacets[a]:"inist"==a?e.aggregations["categories.inist"]=t.queriedFacets[a]:"scopus"==a?e.aggregations["categories.scopus"]=t.queriedFacets[a]:"scienceMetrix"==a?e.aggregations["categories.scienceMetrix"]=t.queriedFacets[a]:"teeft"==a?e.aggregations["keywords.teeft"]=t.queriedFacets[a]:e.aggregations[a]=t.queriedFacets[a]);t.aggregations=e.aggregations,t.queriedFacets={},t.maxPagesInPagination=t.istexConfigDefault.maxPagesInPagination,t.nbrPages=Math.ceil(t.total/t.istexConfigDefault.pageSize),t.firstPageURI={id:1},t.lastPageURI={id:t.nbrPages},t.nbrPages<t.maxPagesInPagination&&(t.maxPagesInPagination=t.nbrPages),t.pageCourante=1;var s=[];for(i=1;i<=t.maxPagesInPagination;i++)s.push({id:i});t.pages=s,t.showResults=!0,t.showLoading=!1}}).error(function(e){t.showLoading=!1,t.showError=!0,console.log("ERROR : Corpus Search")})}}]),app.factory("istexFacetsService",["$http","$rootScope",function(e,t){return{facetSearch:function(a,i){var s,n=t.currentPageURI,r=" OR ",c=r.length,o=" AND corpusName:(";i.corpusName&&i.corpusName.buckets.forEach(function(e,t,a){e.isChecked&&(o+=e.key+r)}),o=" AND corpusName:("!=o?o.substring(0,o.length-c)+")":o="",(s=n.split("&"))[0]+=o,o&&(t.queriedFacets.corpusName=i.corpusName)," AND corpusName:("!==o&&(n=s.join("&"));var l=" AND language:(";i.language&&i.language.buckets.forEach(function(e,t,a){e.isChecked&&(l+=e.key+r)}),l=" AND language:("!=l?l.substring(0,l.length-c)+")":l="",(s=n.split("&"))[0]+=l,l&&(t.queriedFacets.language=i.language)," AND language:("!==l&&(n=s.join("&"));var g=" AND categories.wos:(";i["categories.wos"]&&i["categories.wos"].buckets.forEach(function(e,t,a){e.isChecked&&(g+='"'+e.key.replace("&","%26")+'"'+r)}),g=" AND categories.wos:("!=g?g.substring(0,g.length-c)+")":g="",(s=n.split("&"))[0]+=g,g&&(t.queriedFacets.wos=i["categories.wos"])," AND categories.wos:("!==g&&(n=s.join("&"));var u=" AND categories.inist:(";i["categories.inist"]&&i["categories.inist"].buckets.forEach(function(e,t,a){e.isChecked&&(u+='"'+e.key.replace("&","%26")+'"'+r)}),u=" AND categories.inist:("!=u?u.substring(0,u.length-c)+")":u="",(s=n.split("&"))[0]+=u,u&&(t.queriedFacets.inist=i["categories.inist"])," AND categories.inist:("!==u&&(n=s.join("&"));var d=" AND categories.scopus:(";i["categories.scopus"]&&i["categories.scopus"].buckets.forEach(function(e,t,a){e.isChecked&&(d+='"'+e.key.replace("&","%26")+'"'+r)}),d=" AND categories.scopus:("!=d?d.substring(0,d.length-c)+")":d="",(s=n.split("&"))[0]+=d,d&&(t.queriedFacets.scopus=i["categories.scopus"])," AND categories.scopus:("!==d&&(n=s.join("&"));var p=" AND keywords.teeft.raw:(";i["keywords.teeft"]&&i["keywords.teeft"].buckets.forEach(function(e,t,a){e.isChecked&&(p+='"'+e.key.replace("&","%26")+'"'+r)}),p=" AND keywords.teeft.raw:("!=p?p.substring(0,p.length-c)+")":p="",(s=n.split("&"))[0]+=p,p&&(t.queriedFacets.teeft=i["keywords.teeft"])," AND keywords.teeft.raw:("!==p&&(n=s.join("&"));var f=" AND categories.scienceMetrix:(";i["categories.scienceMetrix"]&&i["categories.scienceMetrix"].buckets.forEach(function(e,t,a){e.isChecked&&(f+='"'+e.key.replace("&","%26")+'"'+r)}),f=" AND categories.scienceMetrix:("!=f?f.substring(0,f.length-c)+")":f="",(s=n.split("&"))[0]+=f,f&&(t.queriedFacets.scienceMetrix=i["categories.scienceMetrix"])," AND categories.scienceMetrix:("!==f&&(n=s.join("&"));var h=" AND genre:(";i.genre&&i.genre.buckets.forEach(function(e,t,a){e.isChecked&&(h+=e.key+r)}),h=" AND genre:("!=h?h.substring(0,h.length-c)+")":h="",(s=n.split("&"))[0]+=h,h&&(t.queriedFacets.genre=i.genre)," AND genre:("!==h&&(n=s.join("&"));var x="",b=function(e,t,a,i){var s,n,r=" AND "+e+":[";if(a||(a=parseInt(t.buckets[0].toAsString)||t.buckets[0].to),i||(i=parseInt(t.buckets[0].fromAsString)||t.buckets[0].from),t){if(s=parseInt(t.buckets[0].bot),s=!isNaN(s)&&s>i?Math.floor(s):i,n=parseInt(t.buckets[0].top),s>(n=!isNaN(n)&&a>n?Math.ceil(n):a)){var c=s;s=n,n=c}return(s!=i||n!=a)&&(r+=s+" TO "+n+"]"),r}};return i.publicationDate&&(s=n.split("&"),x=b("publicationDate",i.publicationDate),s[0]+=x," AND publicationDate:["!==x&&(t.queriedFacets.publicationDate=i.publicationDate),x&&" AND publicationDate:["!==x&&(n=s.join("&"))),i.copyrightDate&&(s=n.split("&"),x=b("copyrightDate",i.copyrightDate),s[0]+=x," AND copyrightDate:["!==x&&(t.queriedFacets.copyrightDate=i.copyrightDate),x&&" AND copyrightDate:["!==x&&(n=s.join("&"))),i.score&&(s=n.split("&"),x=b("qualityIndicators.score",i.score),s[0]+=x," AND qualityIndicators.score:["!==x&&(t.queriedFacets.score=i.score),x&&" AND qualityIndicators.score:["!==x&&(n=s.join("&"))),t.currentFacetsURI=n,t.searchTimeA=(new Date).getTime(),e.jsonp(n+"&callback=JSON_CALLBACK")}}}]),app.directive("istexSearch",function(){return{template:'<div id="istex-widget-search" ng-controller="IstexsearchCtrl" ><form><div class="input-group"><input class="form-control adding-logo-to-input" type="search" value="" placeholder="{{istexConfigDefault.labels.search.placeholder.main || \'Votre requête ici ...\'}}" ng-model="query" ng-focus="istexConfigDefault.focusInputQueryOnLoad"><span class="input-group-btn"><input type="submit" class="btn btn-default" ng-click="search()" value="Rechercher"></span></div><div class="istex-advanced-wrapper" ng-if="istexConfigDefault.advancedToLoad"><div class="istex-advanced-button" ng-click="toggleAdvanced()" ng-if="!istexConfigDefault.advancedExpanded"><a href="" >{{ (istexConfigDefault.labels.search["advancedTitle"] || "Recherche avancée") | capitalize}}</a></div><div class="istex-advanced-inputs"><div class="istex-advanced" ng-repeat="(advancedName, advanced) in advancedQuery" ng-show="showAdvanced"><h5 class="istex-advanced-name">{{ (istexConfigDefault.labels.search[advancedName] || advancedName) | capitalize}}</h5><div class="istex-advanced-{{advancedName}}" ><input class="istex-search-advanced-input" type="search" ng-model="advancedQuery[advancedName]" placeholder="{{istexConfigDefault.labels.search.placeholder[advancedName]}}"></div></div></div></div><p class="istex-search-error"></p><div class="istex-search-loading" title="Recherche en cours" ng-toggle="showLoading && !noresult" ></div></form></div>'}}),app.controller("IstexsearchCtrl",["$scope","$rootScope","istexSearchService",function(e,t,a){if(t.showAdvanced=!1,t.showResults=!1,t.showLoading=!1,t.istexConfigDefault.advancedToLoad&&(e.advancedQuery=t.istexConfigDefault.advancedToLoad),!1!==t.istexConfigDefault.query){var s=t.istexConfigDefault.query;t.query=s?s.toString():""}e.search=function(){t.showResults=!1,t.showFacets=!1,t.showLoading=!0,a.search(e).success(function(e){if(t.showError=!1,t.searchTimeB=(new Date).getTime(),t.totalSearchTime=((t.searchTimeB-t.searchTimeA)/1e3).toFixed(2),t.noresult=0===e.total,!t.noresult){t.elasticSearchTime=(e.stats.elasticsearch.took/1e3).toFixed(2),t.istexSearchTime=(e.stats["istex-api"].took/1e3).toFixed(2),t.reseauSearchTime=(t.totalSearchTime-t.elasticSearchTime-t.istexSearchTime).toFixed(2),t.documents=e.hits,t.total=e.total,t.nextPageURI=e.nextPageURI,t.aggregations=e.aggregations,t.aggregations&&t.aggregations.publicationDate&&(t.aggregations.publicationDate.buckets[0].top=parseInt(t.aggregations.publicationDate.buckets[0].toAsString),t.aggregations.publicationDate.buckets[0].bot=parseInt(t.aggregations.publicationDate.buckets[0].fromAsString||0)),t.aggregations&&t.aggregations.copyrightDate&&(t.aggregations.copyrightDate.buckets[0].top=parseInt(t.aggregations.copyrightDate.buckets[0].toAsString),t.aggregations.copyrightDate.buckets[0].bot=parseInt(t.aggregations.copyrightDate.buckets[0].fromAsString||0)),t.aggregations&&t.aggregations.score&&(t.aggregations.score.buckets[0].top=10,t.aggregations.score.buckets[0].bot=0),t.maxPagesInPagination=t.istexConfigDefault.maxPagesInPagination,t.nbrPages=Math.ceil(t.total/t.istexConfigDefault.pageSize),t.firstPageURI={id:1},t.lastPageURI={id:t.nbrPages},t.nbrPages<t.maxPagesInPagination&&(t.maxPagesInPagination=t.nbrPages),t.pageCourante=1;var a=[];for(i=1;i<=t.maxPagesInPagination;i++)a.push({id:i});t.pages=a,t.showLoading=!1,t.showResults=!0,t.showFacets=!0}}).error(function(e){t.showLoading=!1,t.showError=!0,console.error("ERROR : Search"),console.error(e)})},e.toggleAdvanced=function(){if(t.showAdvanced=!t.showAdvanced,!t.showAdvanced)for(var a in e.advancedQuery)Object.prototype.hasOwnProperty.call(e.advancedQuery,a)&&(e.advancedQuery[a]="")},t.istexConfigDefault.advancedExpanded&&e.toggleAdvanced()}]),app.factory("istexSearchService",["$http","$rootScope",function(e,t){return{search:function(a){var i,s=t.istexConfigDefault.istexApi;void 0!=localStorage.getItem("idc")&&(i=JSON.parse(localStorage.getItem("idc"))),s+="/document/?q=";var n=a.query?a.query.toString():"",r=this.advancedSearch(a.advancedQuery);return s+=""!=n?n:"*",s+=""!=r?r:"",i?(s+=" AND grantees.raw:"+i.value.id,s+=" &output=*",s+="&stats=1",t.defaultSort?s+="&sortBy="+t.defaultSort:t.istexConfigDefault.defaultSort&&(s+="&sortBy="+t.istexConfigDefault.defaultSort),s+="&defaultOperator="+t.istexConfigDefault.operator+("&facet="+t.istexConfigDefault.facetsToLoad.join())+("&size="+t.istexConfigDefault.pageSize)+"&sid=istex-widgets",t.currentPageURI=s,t.searchTimeA=(new Date).getTime(),e.jsonp(s+"&callback=JSON_CALLBACK")):(s=t.istexConfigDefault.istexApi,e.jsonp(s))},advancedSearch:function(e){var t="";for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&""!=e[a]&&(t+=" AND "+a+":"+e[a]);return t}}}]),app.directive("istexSelect2",function(){return{template:'<div id="istex-widget-select2" ng-controller="Istexselect2Ctrl" ><ui-select ng-model="selected.value" ng-change="update()" ><ui-select-match placeholder="Choisir un établissement"><span ng-bind="$select.selected.text"></span></ui-select-match><ui-select-choices repeat="item in (itemArray | filter: $select.search) track by item.id" ><span ng-bind="item.text" ></span></ui-select-choices></ui-select></div><br>'}}),app.controller("Istexselect2Ctrl",["$scope","$rootScope","$http",function(e,t,a){e.update=function(){localStorage.setItem("idc",JSON.stringify(t.selected))},a.get("listeInstitutions.json").then(function(e){t.itemArray=e.data,t.selected={},void 0!=localStorage.getItem("idc")&&(t.selected=JSON.parse(localStorage.getItem("idc")))})}]),app.factory("istexSelect2Service",["$http","$rootScope",function(e,t){return{etabListChange:function(e){}}}]),app.directive("istexResults",function(){return{template:'<div class="istex-results-noresult" ng-show="noresult">{{istexConfigDefault.labels.results.noresult || "Il n\'y a pas de résultat à afficher !"}}</div><div class="istex-results-error" ng-show="showError">Une erreur est survenue, veuillez réessayer plus tard. Si cette erreur persiste, vous pouvez envoyer un mail à <a href="mailto:istex-contact@univ-lorraine.fr" target="_blank">l\'équipe ISTEX-SNU</a></div><div class="istex-hidebutton" ng-click="istexConfigDefault.hideButton = false;" ng-show="!noresult && istexConfigDefault.hideButton && !showError" title="{{istexConfigDefault.labels.results.showResult || \'Cliquez pour afficher les résultats\'}}">{{ total || ". . . . . . . . ." | numberize }} documents</div><div id="istex-widget-results" style="opacity: 1;" ng-controller="IstexresultsCtrl" ng-toggle="showResults" ng-show="!noresult && !istexConfigDefault.hideButton"><div class="istex-results-items-stats" ng-toggle="!hideStats">Environ {{ total | numberize }} résultats <span title="Réseau : {{reseauSearchTime}} sec, Moteur de recherche : {{elasticSearchTime}} sec, Traitements de l\'API : {{istexSearchTime}} sec" ng-if="istexConfigDefault.showQuerySpeed">({{totalSearchTime}} secondes)</span></div><div class="istex-results-sort" ><select class="input-sm form-control" ng-model="defaultSort" ng-change="sortBy(defaultSort)" ><option ng-repeat="sort in istexConfigDefault.possibleSorts" value="{{sort.value}}">{{sort.name}}</option></select></div><div class="istex-results-pagination" ng-if="istexConfigDefault.showPaginationTop"><a href="" class="istex-results-pagination-prec" title="Page précédente" ng-click="selectPage(pageCourante-1)" ng-if="pageCourante !== firstPageURI.id"> < </a><ul class="istex-results-pagination-plist"><li ng-repeat="page in pages" ><a href="" ng-click="selectPage(page.id)" ng-if="pageCourante !== page.id ">{{page.id}}</a><span class="istex-results-pagination-page-selected" ng-if="pageCourante === page.id">{{page.id}}</span></li></ul><a href="" class="istex-results-pagination-next" title="Page suivante" ng-click="selectPage(pageCourante+1)" ng-if="pageCourante !== lastPageURI.id"> > </a></div><ol class="istex-results-items" ng-toggle="!hideResults"><li class="istex-results-item" ng-repeat="document in documents"><a class="istex-results-item-title" target="_blank" ng-if="istexConfigDefault.resultContent.title" ng-href="{{document.fulltext[0].uri | sidize | proxify:istexConfigDefault.proxyApi }}" >{{ document.title | ellipse:true:istexConfigDefault.titleLength:"..." }}</a><p class="istex-results-item-abstract" ng-if="document.abstract && istexConfigDefault.resultContent.abstract" title="{{ document.abstract }}">{{ document.abstract | ellipse:false:istexConfigDefault.abstractLength:"..."  }}</p><p class="istex-results-item-abstract" title="Pas de résumé" ng-if="!document.abstract  && istexConfigDefault.resultContent.abstract">{{ istexConfigDefault.labels.results[\'abstract\'] || "Pas de résumé disponible pour cet article" }}</p><p class="istex-results-item-author" ng-if="istexConfigDefault.resultContent.author" ><span ng-repeat="author in document.author">{{author.name}}. </span></p><p class="istex-results-item-journal" ng-if="istexConfigDefault.resultContent.journal">{{document.host.title}} vol.{{document.host.volume}}, page {{document.host.pages.first}} - {{document.host.pages.last}}</p><div class="istex-tag" ng-repeat="(name, value) in istexConfigDefault.tags"><span ng-if="name==\'genre\'" ng-repeat="genre in document.genre" class="istex-tag">{{value}} {{ genre | capitalize }}</span><span ng-if="name!=\'genre\'" class="istex-tag">{{value}} {{ document[name] | capitalize }}</span></div><div ng-if="istexConfigDefault.qualityIndicator"><b>Qualité du fulltext</b> : <div class="star-rating" title="{{document.qualityIndicators.score}}"><div class="full-star" ng-style="{width: \'{{document.qualityIndicators.score*10 || 0}}%\'}"></div><div class="empty-star">{{document.qualityIndicators.score || 0}}</div></div></div><div class="downloads"><div class="download fulltext"><h4>{{ istexConfigDefault.labels.results["fulltext"] || "Fulltext" }}</h4><ul class="istex-results-item-download"><li class="istex-results-item-dl fulltext" ng-repeat="fulltext in document.fulltext"><a ng-href="{{ fulltext.uri | sidize | proxify:istexConfigDefault.proxyApi }}" class="istex-results-item-dl-{{ fulltext.extension }}" title="Télécharger le fichier {{ fulltext.extension | uppercase }}" target="_blank">{{ fulltext.extension | uppercase }}</a></li></ul></div><div class="download metadata"><h4>{{ (istexConfigDefault.labels.results["metadata"] || "Metadata") }}</h4><ul class="istex-results-item-download metadata"><li class="istex-results-item-dl" ng-repeat="metadata in document.metadata"><a ng-href="{{ metadata.uri | sidize | proxify:istexConfigDefault.proxyApi }}" class="istex-results-item-dl-{{ metadata.extension }}" title="Télécharger le fichier {{ metadata.extension | uppercase }}" target="_blank">{{ metadata.extension | uppercase }}</a></li></ul></div><div class="download enrichment" ng-if="document.enrichments"><h4>{{ (istexConfigDefault.labels.results["enrichment"] || "Enrichissements") }}</h4><ul class="istex-results-item-download enrichment"><li class="istex-results-item-dl" ng-repeat="(name, enrichment) in document.enrichments"><a ng-href="{{ enrichment[0].uri | sidize | proxify:istexConfigDefault.proxyApi }}" class="istex-results-item-dl-{{ enrichment[0].extension }}" title="Télécharger le fichier {{ name }}" target="_blank">XML</a></li></ul></div></div><div class="istex-results-item-bottom"></div><hr style="border-top-color: black;"/></li></ol><div class="istex-results-pagination" ng-if="istexConfigDefault.showPaginationBot"><a href="#istex-widget-search" class="istex-results-pagination-prec" title="Page précédente" ng-click="selectPage(pageCourante-1)" ng-if="pageCourante !== firstPageURI.id"> < </a><ul class="istex-results-pagination-plist"><li ng-repeat="page in pages" ><a href="#istex-widget-search" ng-click="selectPage(page.id)" ng-if="pageCourante !== page.id ">{{page.id}}</a><span class="istex-results-pagination-page-selected" ng-if="pageCourante === page.id">{{page.id}}</span></li></ul><a href="#istex-widget-search" class="istex-results-pagination-next" title="Page suivante" ng-click="selectPage(pageCourante+1)" ng-if="pageCourante !== lastPageURI.id"> > </a></div></div>'}}),app.controller("IstexresultsCtrl",["$scope","$rootScope","istexResultsService",function(e,t,a){t.showResults=!1,t.defaultSort=t.istexConfigDefault.defaultSort,!1!==t.istexConfigDefault.query&&(t.showLoading=!0),!1!==t.istexConfigDefault.query&&a.defaultSearch(t.istexConfigDefault.query).success(function(e){if(t.showError=!1,t.searchTimeB=(new Date).getTime(),t.totalSearchTime=((t.searchTimeB-t.searchTimeA)/1e3).toFixed(2),t.noresult=0===e.total,!t.noresult){t.elasticSearchTime=(e.stats.elasticsearch.took/1e3).toFixed(2),t.istexSearchTime=(e.stats["istex-api"].took/1e3).toFixed(2),t.reseauSearchTime=(t.totalSearchTime-t.elasticSearchTime-t.istexSearchTime).toFixed(2),t.documents=e.hits,t.total=e.total,t.nextPageURI=e.nextPageURI,t.aggregations=e.aggregations,t.aggregations.publicationDate&&(t.aggregations.publicationDate.buckets[0].top=parseInt(t.aggregations.publicationDate.buckets[0].toAsString),t.aggregations.publicationDate.buckets[0].bot=parseInt(t.aggregations.publicationDate.buckets[0].fromAsString||0)),t.aggregations.copyrightDate&&(t.aggregations.copyrightDate.buckets[0].top=parseInt(t.aggregations.copyrightDate.buckets[0].toAsString),t.aggregations.copyrightDate.buckets[0].bot=parseInt(t.aggregations.copyrightDate.buckets[0].fromAsString||0)),t.aggregations.score&&(t.aggregations.score.buckets[0].top=10,t.aggregations.score.buckets[0].bot=0),t.maxPagesInPagination=t.istexConfigDefault.maxPagesInPagination,t.nbrPages=Math.ceil(t.total/t.istexConfigDefault.pageSize),t.firstPageURI={id:1},t.lastPageURI={id:t.nbrPages},t.nbrPages<t.maxPagesInPagination&&(t.maxPagesInPagination=t.nbrPages),t.pageCourante=1;var a=[];for(i=1;i<=t.maxPagesInPagination;i++)a.push({id:i});t.pages=a,t.showResults=!0,t.showFacets=!0,t.showLoading=!1}}).error(function(e){t.showLoading=!1,t.showError=!0,console.error("ERROR : Default Search")}),e.selectPage=function(e){t.showLoading=!0;var s=(e-1)*t.istexConfigDefault.pageSize;t.istexConfigDefault.pageSize+s>t.istexConfigDefault.maxResults&&(e=(s=t.istexConfigDefault.maxResults-t.istexConfigDefault.pageSize)/t.istexConfigDefault.pageSize+1),t.pageCourante=e,t.pageCourante>=1+Math.ceil(t.maxPagesInPagination/2)&&t.pageCourante<=t.nbrPages-Math.ceil(t.maxPagesInPagination/2)?(t.pageStart=t.pageCourante-Math.floor(t.maxPagesInPagination/2-.5),t.pageEnd=t.pageCourante+Math.ceil(t.maxPagesInPagination/2-.5)):t.pageCourante<1+Math.ceil(t.maxPagesInPagination/2)?(t.pageStart=1,t.pageEnd=t.maxPagesInPagination):t.pageCourante>t.nbrPages-Math.ceil(t.maxPagesInPagination/2)&&(t.pageStart=t.nbrPages-t.maxPagesInPagination+1,t.pageEnd=t.nbrPages);var n=[];for(i=t.pageStart;i<=t.pageEnd;i++)n.push({id:i});t.pages=n,t.hideResults=!0,t.hideStats=!0,a.search(s).success(function(e){t.showError=!1,t.searchTimeB=(new Date).getTime(),t.totalSearchTime=((t.searchTimeB-t.searchTimeA)/1e3).toFixed(2),t.elasticSearchTime=(e.stats.elasticsearch.took/1e3).toFixed(2),t.istexSearchTime=(e.stats["istex-api"].took/1e3).toFixed(2),t.reseauSearchTime=(t.totalSearchTime-t.elasticSearchTime-t.istexSearchTime).toFixed(2),t.documents=e.hits,t.nextPageURI=e.nextPageURI,t.hideResults=!1,t.hideStats=!1,t.showLoading=!1}).error(function(e){t.showLoading=!1,t.showError=!0,console.error("ERROR : Pagination")})},e.sortBy=function(e){t.showLoading=!0,t.hideResults=!0,t.hideStats=!0,t.istexConfigDefault.defaultSort?t.defaultSort=e+","+t.istexConfigDefault.defaultSort:t.defaultSort=e,a.sortedSearch(e).success(function(e){t.showError=!1,t.searchTimeB=(new Date).getTime(),t.totalSearchTime=((t.searchTimeB-t.searchTimeA)/1e3).toFixed(2),t.elasticSearchTime=(e.stats.elasticsearch.took/1e3).toFixed(2),t.istexSearchTime=(e.stats["istex-api"].took/1e3).toFixed(2),t.reseauSearchTime=(t.totalSearchTime-t.elasticSearchTime-t.istexSearchTime).toFixed(2),t.documents=e.hits,t.nextPageURI=e.nextPageURI,t.pageCourante=1,t.hideResults=!1,t.hideStats=!1,t.showLoading=!1}).error(function(e){t.showLoading=!1,t.showError=!0,console.error("ERROR : SortBy")})}}]),app.factory("istexResultsService",["$http","$rootScope",function(e,t){return{search:function(a){var i=t.currentPageURI;t.currentFacetsURI&&(i=t.currentFacetsURI);var s="&from=";return i+=s+=a,t.searchTimeA=(new Date).getTime(),e.jsonp(i+"&callback=JSON_CALLBACK")},defaultSearch:function(a){var i=t.istexConfigDefault.istexApi;i+="/document/?q=";var s=a?a.toString():"";return i+=""!=s?s:"*",i+="&stats=1",t.defaultSort?i+="&sortBy="+t.defaultSort:t.istexConfigDefault.defaultSort&&(i+="&sortBy="+t.istexConfigDefault.defaultSort),i+="&defaultOperator="+t.istexConfigDefault.operator+("&facet="+t.istexConfigDefault.facetsToLoad.join())+("&size="+t.istexConfigDefault.pageSize)+"&sid=istex-widgets",t.currentPageURI=i,t.searchTimeA=(new Date).getTime(),e.jsonp(i+"&callback=JSON_CALLBACK")},sortedSearch:function(a){var i=t.istexConfigDefault.defaultSort,s="",n=/(&sortBy=)[a-zA-Z\[\],]*(&?)/;return i&&(a+=","+i),i||a?(s=t.currentPageURI.replace(n,"$1"+a+"$2"),t.currentPageURI=s,t.currentFacetsURI&&(s=t.currentFacetsURI.replace(n,"$1"+a+"$2"),t.currentFacetsURI=s)):(s=t.currentPageURI.replace(n,""),t.currentPageURI=s,t.currentFacetsURI&&(s=t.currentFacetsURI.replace(n,""),t.currentFacetsURI=s)),a&&-1==s.indexOf("sortBy")&&(s=t.currentPageURI+"&sortBy="+a,t.currentPageURI=s,t.currentFacetsURI&&(s=t.currentFacetsURI+"&sortBy="+a,t.currentFacetsURI=s)),t.searchTimeA=(new Date).getTime(),e.jsonp(s+"&callback=JSON_CALLBACK")}}}]),app.run(["$rootScope",function(e){e.istexConfigDefault={istexApi:"https://api.panist.fr",proxyApi:"https://api.panist.fr",query:!1,operator:"AND",focusInputQueryOnLoad:!1,facetsToLoad:["genre","corpusName","publicationDate","copyrightDate","language","categories.wos","categories.inist","score"],hideButton:!1,advancedToLoad:{"author.name":"",genre:"","host.title":"","host.genre":"","subject.value":"",language:""},advancedExpanded:!1,slider:!0,showPaginationTop:!0,showPaginationBot:!0,maxResults:1e4,pageSize:10,maxPagesInPagination:10,abstractLength:250,titleLength:150,fullTextOnTitle:"pdf",showQuerySpeed:!0,shownFacet:!0,resultContent:{title:!0,abstract:!0,author:!0,journal:!0},tags:{publicationDate:"Publié en",corpusName:"",genre:"Type :"},defaultSort:"",possibleSorts:[{value:"",name:"Pertinence"},{value:"score[desc]",name:"Qualité du fulltext"},{value:"publicationDate",name:"Date de publication (croissant)"},{value:"publicationDate[desc]",name:"Date de publication (décroissant)"}],qualityIndicator:!1,labels:{search:{advancedTitle:"Recherche avancée","author.name":"Auteur","host.title":"Titre de la collection",genre:"Genre du document","host.genre":"Genre de la collection","subject.value":"Sujet du document",language:"Langue",placeholder:{main:"Votre requête ici ...","author.name":"ex : Dijkstra","host.editor.name":"","host.title":"ex : Journal of Algebra",genre:"ex : article, paper, ...","host.genre":" ex : ebook, reviews, ...","subject.value":"ex : cell division",language:"3 lettres : fre, eng, ita, ..."}},results:{noresult:"Pas de résultat (Faites attention quand vous utilisez plusieurs facettes)",showResult:"Affichez les résultats",abstract:"Pas de résumé",fulltext:"Texte complet",metadata:"Métadonnées",enrichment:"Enrichissements"},facets:{title:"Affiner votre recherche",corpusName:"Corpus",publicationDate:"Date de publication",copyrightDate:"Début du copyright",score:"Qualité du fulltext","categories.wos":"Catégories WOS","categories.inist":"Cat. Pascal & Francis",language:"Langue",traduction:"fr"}}},window.istexConfig&&Object.getOwnPropertyNames(window.istexConfig).length>0&&(e.istexConfigDefault=extend(e.istexConfigDefault,window.istexConfig))}]),angular.element(document).ready(function(){angular.bootstrap(document,["app"])});
